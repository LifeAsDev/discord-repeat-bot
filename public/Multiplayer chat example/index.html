<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Multiplayer chat example</title>
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
		/>

		<!-- Made with Construct, the game and app creator :: https://www.construct.net -->
		<meta name="generator" content="Scirra Construct" />

		<link rel="manifest" href="appmanifest.json" />
		<link rel="apple-touch-icon" sizes="128x128" href="icons/icon-128.png" />
		<link rel="apple-touch-icon" sizes="256x256" href="icons/icon-256.png" />
		<link rel="icon" type="image/png" href="icons/icon-256.png" />

		<link rel="stylesheet" href="style.css" />
	</head>

	<body>
		<script>
			if (location.protocol.substr(0, 4) === "file") {
				alert(
					"Web exports won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)"
				);
			}
		</script>
		<script>
			(function () {
				const logBox = document.createElement("div");
				Object.assign(logBox.style, {
					position: "fixed",
					bottom: "0",
					left: "0",
					width: "100%",
					maxHeight: "40vh",
					overflowY: "auto",
					background: "rgba(0,0,0,0.8)",
					color: "#0f0",
					fontFamily: "monospace",
					fontSize: "12px",
					padding: "6px",
					zIndex: 999999,
					whiteSpace: "pre-wrap",
				});
				document.body.appendChild(logBox);

				function print(type, args) {
					const msg = `[${type}] ${args
						.map((a) => (typeof a === "object" ? JSON.stringify(a) : a))
						.join(" ")}\n`;
					logBox.textContent += msg;
					logBox.scrollTop = logBox.scrollHeight;
				}

				const origLog = console.log;
				const origErr = console.error;
				const origWarn = console.warn;

				console.log = (...args) => {
					origLog(...args);
					print("LOG", args);
				};
				console.error = (...args) => {
					origErr(...args);
					print("ERR", args);
				};
				console.warn = (...args) => {
					origWarn(...args);
					print("WARN", args);
				};

				window.onerror = function (msg, src, line, col, err) {
					print("ONERROR", [msg, src, line, col, err?.stack || ""]);
				};
			})();
		</script>
		<script>
			// instalar con: npm install ws
			import WebSocket from "ws";

			const wsUrl = "wss://1411008879885549711.discordsays.com/connect";

			// Headers que replican tu request
			const headers = {
				Origin: "https://rustycoon.site",
				"Sec-WebSocket-Protocol": "c2multiplayer",
				"User-Agent":
					"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36",
				"Sec-WebSocket-Version": "13",
				"Sec-WebSocket-Extensions":
					"permessage-deflate; client_max_window_bits",
				"Cache-Control": "no-cache",
				Pragma: "no-cache",
			};

			const ws = new WebSocket(wsUrl, "c2multiplayer", { headers });

			ws.on("open", () => {
				console.log("‚úÖ Conexi√≥n WebSocket abierta");
				// enviar un mensaje de prueba
				ws.send(JSON.stringify({ type: "hello", content: "testing" }));
			});

			ws.on("message", (msg) => {
				console.log("üì© Mensaje recibido:", msg.toString());
			});

			ws.on("close", (code, reason) => {
				console.log("‚ùå Conexi√≥n cerrada", code, reason.toString());
			});

			ws.on("error", (err) => {
				console.error("‚ö†Ô∏è Error en WebSocket:", err);
			});
		</script>
		<noscript>
			<div id="notSupportedWrap">
				<h2 id="notSupportedTitle">This content requires JavaScript</h2>
				<p class="notSupportedMessage">
					JavaScript appears to be disabled. Please enable it to view this
					content.
				</p>
			</div>
		</noscript>
		<script src="scripts/modernjscheck.js"></script>
		<script src="scripts/supportcheck.js"></script>
		<script src="scripts/offlineclient.js" type="module"></script>
		<script src="scripts/main.js" type="module"></script>
		<script src="scripts/register-sw.js" type="module"></script>
	</body>
</html>

<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Multiplayer chat example</title>
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
		/>

		<!-- Made with Construct, the game and app creator :: https://www.construct.net -->
		<meta name="generator" content="Scirra Construct" />

		<link rel="manifest" href="appmanifest.json" />
		<link rel="apple-touch-icon" sizes="128x128" href="icons/icon-128.png" />
		<link rel="apple-touch-icon" sizes="256x256" href="icons/icon-256.png" />
		<link rel="icon" type="image/png" href="icons/icon-256.png" />

		<link rel="stylesheet" href="style.css" />
	</head>

	<body>
		<script>
			if (location.protocol.substr(0, 4) === "file") {
				alert(
					"Web exports won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)"
				);
			}
		</script>
		<script>
			(function () {
				const logBox = document.createElement("div");
				Object.assign(logBox.style, {
					position: "fixed",
					bottom: "0",
					left: "0",
					width: "100%",
					maxHeight: "40vh",
					overflowY: "auto",
					background: "rgba(0,0,0,0.8)",
					color: "#0f0",
					fontFamily: "monospace",
					fontSize: "12px",
					padding: "6px",
					zIndex: 999999,
					whiteSpace: "pre-wrap",
				});
				document.body.appendChild(logBox);

				function print(type, args) {
					const msg = `[${type}] ${args
						.map((a) => (typeof a === "object" ? JSON.stringify(a) : a))
						.join(" ")}\n`;
					logBox.textContent += msg;
					logBox.scrollTop = logBox.scrollHeight;
				}

				const origLog = console.log;
				const origErr = console.error;
				const origWarn = console.warn;

				console.log = (...args) => {
					origLog(...args);
					print("LOG", args);
				};
				console.error = (...args) => {
					origErr(...args);
					print("ERR", args);
				};
				console.warn = (...args) => {
					origWarn(...args);
					print("WARN", args);
				};

				window.onerror = function (msg, src, line, col, err) {
					print("ONERROR", [msg, src, line, col, err?.stack || ""]);
				};
			})();
		</script>
		<script>
			const wsUrl = "wss://1411008879885549711.discordsays.com/connect";

			// Protocolo a usar
			const protocol = "c2multiplayer";

			let ws;

			try {
				ws = new WebSocket(wsUrl, protocol);

				// Timeout para cachar silencios
				const timeout = setTimeout(() => {
					console.warn("‚è± WebSocket parece bloqueado o no responde");
					ws.close();
				}, 5000); // 5 segundos

				ws.addEventListener("open", () => {
					clearTimeout(timeout);
					console.log("‚úÖ WebSocket abierto");
					// enviar mensaje de prueba
					ws.send(JSON.stringify({ type: "hello", content: "testing" }));
				});

				ws.addEventListener("message", (msg) => {
					console.log("üì© Mensaje recibido:", msg.data);
				});

				ws.addEventListener("close", (e) => {
					clearTimeout(timeout);
					console.log("‚ùå WebSocket cerrado", e.code, e.reason);
				});

				ws.addEventListener("error", (err) => {
					clearTimeout(timeout);
					console.error("‚ö†Ô∏è Error WebSocket", err);
				});
			} catch (e) {
				console.error("üí• Error creando WebSocket", e);
			}
		</script>
		<noscript>
			<div id="notSupportedWrap">
				<h2 id="notSupportedTitle">This content requires JavaScript</h2>
				<p class="notSupportedMessage">
					JavaScript appears to be disabled. Please enable it to view this
					content.
				</p>
			</div>
		</noscript>
		<script src="scripts/modernjscheck.js"></script>
		<script src="scripts/supportcheck.js"></script>
		<script src="scripts/offlineclient.js" type="module"></script>
		<script src="scripts/main.js" type="module"></script>
		<script src="scripts/register-sw.js" type="module"></script>
	</body>
</html>
